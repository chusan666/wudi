{
  "dashboard": {
    "id": null,
    "title": "API Performance & Resilience Dashboard",
    "tags": ["api", "performance", "resilience"],
    "timezone": "browser",
    "panels": [
      {
        "id": 1,
        "title": "Request Rate",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(http_requests_total[5m])",
            "legendFormat": "{{method}} {{route}}"
          }
        ],
        "yAxes": [
          {
            "label": "Requests/sec"
          }
        ]
      },
      {
        "id": 2,
        "title": "Response Time",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "p95"
          },
          {
            "expr": "histogram_quantile(0.99, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "p99"
          }
        ],
        "yAxes": [
          {
            "label": "Seconds"
          }
        ]
      },
      {
        "id": 3,
        "title": "Error Rate",
        "type": "singlestat",
        "targets": [
          {
            "expr": "rate(http_requests_total{status=~\"5..\"}[5m]) / rate(http_requests_total[5m])",
            "legendFormat": "Error Rate"
          }
        ],
        "valueMaps": [
          {
            "value": "null",
            "text": "N/A"
          }
        ],
        "thresholds": [
          {
            "color": "green",
            "value": null
          },
          {
            "color": "yellow",
            "value": 0.01
          },
          {
            "color": "red",
            "value": 0.05
          }
        ],
        "unit": "percentunit"
      },
      {
        "id": 4,
        "title": "Cache Hit Ratio",
        "type": "singlestat",
        "targets": [
          {
            "expr": "rate(cache_hits_total{hit=\"true\"}[5m]) / (rate(cache_hits_total{hit=\"true\"}[5m]) + rate(cache_hits_total{hit=\"false\"}[5m]))",
            "legendFormat": "Cache Hit Ratio"
          }
        ],
        "thresholds": [
          {
            "color": "red",
            "value": null
          },
          {
            "color": "yellow",
            "value": 0.8
          },
          {
            "color": "green",
            "value": 0.95
          }
        ],
        "unit": "percentunit"
      },
      {
        "id": 5,
        "title": "Circuit Breaker Status",
        "type": "table",
        "targets": [
          {
            "expr": "circuit_breaker_state",
            "legendFormat": "{{service}}",
            "format": "table"
          }
        ],
        "transformations": [
          {
            "id": "organize",
            "options": {
              "excludeByName": {
                "Time": true
              },
              "indexByName": {
                "Time": 0,
                "service": 1,
                "state": 2,
                "failureCount": 3
              },
              "renameByName": {
                "service": "Service",
                "state": "State",
                "failureCount": "Failures"
              }
            }
          }
        ]
      },
      {
        "id": 6,
        "title": "Queue Depth",
        "type": "graph",
        "targets": [
          {
            "expr": "bull_queue_waiting",
            "legendFormat": "{{queue}} waiting"
          },
          {
            "expr": "bull_queue_active",
            "legendFormat": "{{queue}} active"
          }
        ],
        "yAxes": [
          {
            "label": "Jobs"
          }
        ]
      },
      {
        "id": 7,
        "title": "Database Query Performance",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(database_query_duration_seconds_bucket[5m]))",
            "legendFormat": "p95 {{operation}} {{table}}"
          }
        ],
        "yAxes": [
          {
            "label": "Seconds"
          }
        ]
      },
      {
        "id": 8,
        "title": "Memory Usage",
        "type": "graph",
        "targets": [
          {
            "expr": "process_resident_memory_bytes",
            "legendFormat": "RSS Memory"
          },
          {
            "expr": "nodejs_heap_size_used_bytes",
            "legendFormat": "Heap Used"
          }
        ],
        "yAxes": [
          {
            "label": "Bytes",
            "format": "bytes"
          }
        ]
      },
      {
        "id": 9,
        "title": "Health Status",
        "type": "stat",
        "targets": [
          {
            "expr": "health_status",
            "legendFormat": "{{status}}"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "mappings": [
              {
                "options": {
                  "healthy": {
                    "color": "green",
                    "index": 0,
                    "text": "Healthy"
                  },
                  "degraded": {
                    "color": "yellow",
                    "index": 1,
                    "text": "Degraded"
                  },
                  "unhealthy": {
                    "color": "red",
                    "index": 2,
                    "text": "Unhealthy"
                  }
                },
                "type": "value"
              }
            ]
          }
        }
      }
    ],
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "refresh": "30s"
  }
}